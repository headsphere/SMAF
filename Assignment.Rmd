---
title: "Stochastic Process and Forecasting Assignment"
author: "Nick Head"
date: "15 April 2015"
output: pdf_document
---

```{r echo=FALSE}
library(knitr)
read_chunk("Question2-i.sas", labels = "Question2-i")
read_chunk("Question2-ii.sas", labels = "Question2-ii")
read_chunk("Question2-ii-results.lst", labels = "Question2-ii-results", from = 1, to=19)
read_chunk("Question2-ii-results.lst", labels = "Question2-ii-forecasts", from = 20)
read_chunk("Question2-ii-diagnosis.lst", labels = "Question2-ii-diagnosis")
read_chunk("Question2-iii.sas", labels = "Question2-iii")
```

\newpage

##Question 2

###i)

The following SAS code was used to identify and estimate appropriate univariate ARIMA models for each of the avg and end exchange rate time series:

```{r Question2-i, engine='sas', eval=FALSE}

```

The diagnostics plots indicates that the first difference of Avg has an ACF cut-off at lag 1, thereby leading us to believe the data follows an Arima(0,1,1) model with the following model equation:

$$\Delta Y_t = -0.36347 \epsilon_{t-1} +  \epsilon_t$$

![](Question2i-diagnostics-avg.png)

In addition the Ljung-Box chi-square statistics do not have any significant p-values, giving further weight to the chosen model:

```
                             Autocorrelation Check of Residuals

 To        Chi-             Pr >
Lag      Square     DF     ChiSq    --------------------Autocorrelations--------------------

  6        1.30      5    0.9346    -0.010    -0.041    -0.034     0.032     0.046    -0.051
 12        8.50     11    0.6681    -0.071     0.133     0.046     0.079     0.104    -0.066
 18       11.49     17    0.8299     0.059    -0.022     0.030    -0.087     0.075     0.015
 24       16.13     23    0.8497    -0.014    -0.121    -0.044    -0.074    -0.025    -0.066


```

End is found to follow an AR(1) model with the following model equation:

$$Y_t = 0.58167 + 0.96945 Y_{t-1} + \epsilon_t$$

This model was identified by the lag 1 cut-off in the PACF as shown in the diagnostics plots below:

![](Question2i-diagnostics-end.png)

In addition the Ljung-Box chi-square statistics do not have any significant p-values, giving further weight to the chosen model:
```
                            Autocorrelation Check of Residuals

 To        Chi-             Pr >
Lag      Square     DF     ChiSq    --------------------Autocorrelations--------------------

  6        2.84      5    0.7239     0.116     0.043     0.007    -0.048     0.040     0.006
 12       11.19     11    0.4279    -0.050     0.081     0.153     0.092     0.081     0.076
 18       13.25     17    0.7192    -0.035    -0.019    -0.019    -0.022     0.095    -0.033
 24       18.91     23    0.7064    -0.024    -0.076    -0.109    -0.044    -0.028    -0.108
```

\newpage

###ii)

The following SAS code identifies and fits a VAR(p) model to the bivariate data:

```{r Question2-ii, engine='sas', eval=FALSE}

```

Which gives the following truncated output:

```{r Question2-ii-results, engine='sas', eval=FALSE}

```
Based off which the fitted model is as follows:

$$\begin{pmatrix}
   x_t \\
   y_t 
 \end{pmatrix} = 
 \begin{pmatrix}
   .03600 & 0.11050 \\
   .70995 & 0.22236
 \end{pmatrix} 
 \begin{pmatrix}
   x_{t-1} \\
   y_{t-1} 
 \end{pmatrix} + \epsilon_t
$$

The following Portmanteau Statistics shows significant p-values at all lags indicating that this VAR(1) model does not fit adequatly: 

```{r Question2-ii-diagnosis, engine='sas', eval=FALSE}

```

The following outputs show the forecasts of the average exchange rate for the next three months of 2006 are: 0.59273, 0.59261, 0.59261  

```{r Question2-ii-forecasts, engine='sas', eval=FALSE}

```

\newpage

###iii)

```{r Question2-iii, engine='sas', eval=FALSE}

```

\newpage

```{r}
library(zoo)
library(forecast)
latdol.zoo <- read.zoo("LatDol.dat", 
                        index.column = 1:2, 
                        FUN = function(year, month){ as.yearmon(paste(year, month, sep = "-"))})
colnames(latdol.zoo) = c("Avg", "End")

#plot(latdol.zoo)
#plot(diff(latdol.zoo))

#acf(latdol.zoo$Avg)
#acf(diff(latdol.zoo$Avg))
acf(latdol.zoo$Avg, type='partial') #!!!

#fitAvg <- auto.arima(latdol.zoo$Avg)
#plot(forecast(fitAvg,h=20))
arima(latdol.zoo$Avg, order = c(0,1,1))

#acf(latdol.zoo$End)
#acf(diff(latdol.zoo$End))
acf(latdol.zoo$End, type='partial') #!!!
#acf(diff(latdol.zoo$End), type='partial')

#fitEnd <- auto.arima(latdol.zoo$End)
#plot(forecast(fitEnd,h=20))
arima(latdol.zoo$End, order = c(1,0,0))

plot(latdol.zoo$End, ylim=range(latdol.zoo$End, latdol.zoo$Avg))
lines(latdol.zoo$Avg, col=2)

prewhiten(latdol.zoo$Avg, latdol.zoo$End)
ccf(latdol.zoo$Avg, latdol.zoo$End)

```